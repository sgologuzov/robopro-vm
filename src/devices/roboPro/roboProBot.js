/**
 * Robo Bot
 *
 * @overview Compared to the Arduino Uno, this control board use CH340 as
 * use to uart chip, uese oldbootloader to flash the firmware, and there are
 * more A6 and A7 pin options.
 */
const OpenBlockArduinoUnoDevice = require('../arduinoUno/arduinoUno');

const ArduinoPeripheral = require('../common/arduino-peripheral');
const formatMessage = require('format-message');
const ArgumentType = require('../../extension-support/argument-type');
const BlockType = require('../../extension-support/block-type');
const ProgramModeType = require('../../extension-support/program-mode-type');
const Timer = require('../../util/timer');
const Cast = require('../../util/cast');

/**
 * Icon svg to be displayed at the left edge of each extension block, encoded as a data URI.
 * @type {string}
 */
// eslint-disable-next-line max-len
const blockIconURI = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB3aWR0aD0iMTAyIgogICBoZWlnaHQ9IjEwMiIKICAgdmlld0JveD0iMCAwIDI2Ljk4NzUgMjYuOTg3NSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnMzM4IgogICBzb2RpcG9kaTpkb2NuYW1lPSJkcmF3aW5nNC5zdmciCiAgIGlua3NjYXBlOnZlcnNpb249IjEuMi4yIChiMGE4NDg2NTQxLCAyMDIyLTEyLTAxKSIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9Im5hbWVkdmlldzM0MCIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnNob3dwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZWNoZWNrZXJib2FyZD0iMCIKICAgICBpbmtzY2FwZTpkZXNrY29sb3I9IiNkMWQxZDEiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9Im1tIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSI0LjM4OTMzOTUiCiAgICAgaW5rc2NhcGU6Y3g9Ijk4Ljc2MjAxMSIKICAgICBpbmtzY2FwZTpjeT0iNzcuMTE4NjY0IgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTkyMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDUyIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjEiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIiAvPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMzMzUiIC8+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIGQ9Im0gMTEuNjI0NTUzLDI1LjY5MTY5MiBoIDMuNDI0OTAxIGMgMC4xMzYxMDIsLTAuMDM4OCAwLjI3NDI4NSwtMC4wNzE5NyAwLjQwNzcwNSwtMC4xMTk1MiAwLjc5NzM4MiwtMC4yODQxNjIgMS4zMjg4MDUsLTEuMDIyODA3IDEuMzQ3MTE0LC0xLjg2ODgzNyAwLjAwNTYsLTAuMjU4NDQ0IDcuMDZlLTQsLTAuNTE2OTYgNy4wNmUtNCwtMC43NzUzNjkgdiAtMC4xNDQ3NzkgaCAwLjE0NDc4IGMgMC4zMTg4MDQsMCAwLjY0NTUxMSwwLjAzNjQxIDAuOTYyNDExLC0wLjAwNDkgMS4wNzU4NjQsLTAuMTQwMTU5IDEuNzg1MzY5LC0wLjk4MzQwMiAxLjc4Njk1NywtMi4wNjEwMyAwLjAwMzgsLTIuNTQ3NTQ0IDAuMDAxMSwtNS4wOTUxOTUgMC4wMDExLC03LjY0MjczOSB2IC0wLjQ1MTk0MyBoIDAuMTQ0NzggYyAwLjUwNDA0OCwwIDEuMDA4MTY2LC0wLjAwMzUgMS41MTIyNDksMC4wMDU5IDAuMTE4NzEsMC4wMDIzIDAuMjM4MDksMC4xMjgzMDUgMC4yNjY3MzUsMC4yMzgyNjYgMC4zNzIzOTIsMS40MjkwMjkgMC43NDA3OTcsMi44NTkxODcgMS4wOTk4NTMsNC4yOTE2MzkgMC4wMzE5NiwwLjEyNzYzNCAtMC4wNTc3MSwwLjMwODQ2OCAtMC4xNjgzMSwwLjM3NDY4NCAtMC43MTgxMTMsMC40MyAtMS4wNzQ5NDcsMS4wNDg0NTQgLTEuMDcwNzQ5LDEuODg3MTQ2IDAuMDAyMSwwLjQzMzg0NSAtMC4wMDIxLDAuODY3NjkgMC4wMDExLDEuMzAxNTM2IDAuMDAyNSwwLjM0MDc4MiAwLjIxODY4NiwwLjYyNzU5IDAuNTc2Mjk2LDAuNjI4NTQzIDAuMzU2OTA1LDAuMDAxMSAwLjU3NjM2NywtMC4yODM4NDUgMC41Nzk0MDEsLTAuNjI0ODA0IDAuMDA0MSwtMC40NDk5NjcgLTAuMDAxNCwtMC45MDAwMDUgMC4wMDE4LC0xLjM1MDAwNyAwLjAwMzYsLTAuNDk5OTkxIDAuMzQ2MjUxLC0wLjkxNDc4NiAwLjg2MzI0NiwtMC45MTczMjYgMC41MTU4NjYsLTAuMDAyNSAwLjg2NzE2MSwwLjQxMDMxNSAwLjg3MTY0MSwwLjkxMDUxNyAwLjAwNDEsMC40NTAxNDQgLTAuMDAxNCwwLjkwMDMyMyAwLjAwMTgsMS4zNTA0NjYgMC4wMDI1LDAuMzQxMTcxIDAuMjE1Nzk0LDAuNjI4Njg0IDAuNTc0MjUxLDAuNjMxMTU0IDAuMzUzOTc2LDAuMDAyNSAwLjU4MjIyMywtMC4yNzgxMyAwLjU4MDE0MiwtMC42MTk5MzYgLTAuMDAzNiwtMC41ODY1OTcgMC4wMjkzOSwtMS4xNzg1MjIgLTAuMDQ2NTMsLTEuNzYxOTA5IC0wLjA5NzE1LC0wLjc0NzAwNiAtMC41NTk1MDQsLTEuMjQzMzk4IC0xLjI0MjU4NiwtMS41MjI1ODYgLTAuMjAyNDk0LC0wLjA4MjgzIC0wLjMwMjQwMSwtMC4yMDQyMjMgLTAuMzU1NiwtMC40MTUyNTQgLTAuMzUzMDI0LC0xLjQwMDE3MiAtMC43MTUxNDksLTIuNzk4MDg3IC0xLjA3NDAyOSwtNC4xOTY4MTMgLTAuMDE4MSwtMC4wNzA2NiAtMC4wMjg2MSwtMC4xNDI1NTcgLTAuMDQyNjUsLTAuMjEzOTk0IGwgLTAuMDE4NjYsLTAuMDk1MDQgMC4wODA3MiwtMC4wNTM1MiBjIDAuMTQ2Mjk3LC0wLjA5NzA1IDAuMzAxMzQyLC0wLjE4MzcyNiAwLjQzOTM4NCwtMC4yOTI1MjIgMC42NjI3MjcsLTAuNTIyNTY5IDAuOTI5MTQ0LC0xLjQyNTAwOCAwLjY2MTY2OSwtMi4yMjQ3NTQgLTAuMjY4Mjg3LC0wLjgwMTk2OCAtMS4wMTc5NzQsLTEuMzY1MDcxIC0xLjg2NjE1NiwtMS4zNzk1NyAtMC42OTA0NTUsLTAuMDExNzggLTEuMzgxMDg3LC0wLjAwMyAtMi4wNzE2MTMsLTAuMDAzNiAtMC4wOTM4NywtNy4xZS01IC0wLjE4Nzg1MywwIC0wLjI4MTcyNywwIEggMTkuNTk3ODMzIEwgMTkuNTc0NjUzLDguNDU0MjMzIEMgMTkuMzc5ODQ5LDcuNDczOTM2IDE5LjE4NTkyOCw2LjQ5MzQ2MyAxOC45OTE0NzcsNS41MTMwOTUgTCAxOC45NTcxNDcsNS4zNDAwOTQgSCAxOS4xMzM1IGMgMC4yNTYxMTYsMCAwLjUxMjM3MywtMC4wMTQyMiAwLjc2Nzk5NiwwLjAwOTkgMC4xMzc2ODksMC4wMTMwMiAwLjIyNzIyMywwLjE2NTYyOCAwLjI4MTg2OSwwLjI3Nzc0MSAwLjM2Nzg0LDAuNzU1MDQ5IDEuMTc4OTQ1LDEuMjM4MTc3IDIuMDIxMjAxLDEuMTUxMTQ3IDAuODU0MjE0LC0wLjA4ODIzIDEuNTY2OTY1LC0wLjY5NTQzIDEuNzc2NTUsLTEuNTMwMTcxIEMgMjQuMjI4NjI0LDQuMjYzMjY0IDIzLjY3ODUwMywzLjIyMTg2NiAyMi43MjY4ODcsMi44Njc0MzEgMjEuNzYyNDMsMi41MDgzMDQgMjAuNjY0NjIzLDIuOTIyODkxIDIwLjIxNTE1LDMuODU3MTQ3IDIwLjA5NTc3LDQuMTA1MjIgMTkuOTM2MjQ0LDQuMjAwOTk5IDE5LjY2MTAwNyw0LjE4NTMgMTkuMzkxNDg2LDQuMTY5OTUgMTkuMTIxMTE3LDQuMTgyIDE4Ljg1MTMxNCw0LjE4MiBoIC0wLjExMTQ3OCBsIC0wLjAyODUsLTAuMTA3NzAzIGMgLTAuMDI1NzksLTAuMDk3NDQgLTAuMDQ5MjUsLTAuMTk1NDM4IC0wLjA3NzI2LC0wLjI5MjMxMSAtMC40MTQ1ODMsLTEuNDI5ODQgLTEuNzQ5NTI3LC0yLjQ2NjMzNTEgLTMuMjQxNzc0LC0yLjQ4Nzc0ODEgLTEuMzQxMzI5LC0wLjAxOTI2IC0yLjY4Mjc5OSwtMC4wMTI5OCAtNC4wMjQwOTMsLTAuMDAzOCAtMS42MTMxNDQzLDAuMDExMDggLTIuOTQwNDMyMywxLjA1NTc5MTEgLTMuMzYyMzE4MywyLjYwNzc5OTEgLTAuMDE2NzksMC4wNjE3NCAtMC4wMzg1MiwwLjEyMTc0MyAtMC4wNTc5MywwLjE4MjU2MiBsIC0wLjAzMjIxLDAuMTAwNjgyIGggLTAuMTA1NjkyIGMgLTAuMzM4Mjc4LDAgLTAuNjc2Njk3LDAuMDA5MyAtMS4wMTQ2OTMsLTAuMDA4NCBDIDYuNjYyMjI3Nyw0LjE2NjE4MSA2LjU1MjE5NjcsNC4wMjg0NDMgNi40OTU1NDA3LDMuOTE4Njk0IDYuMTAwMTQ4NywzLjE1MjY3NCA1LjQ4NzE5ODcsMi43Mzk4MTkgNC42MTY1MDkxLDIuNzM5NjA3IDMuNTg1OTQxNCwyLjczOTMyNSAyLjc4NzMyNDcsMy41MTc0NDUgMi42Mzg2OTk3LDQuNTE3Mjg2IDIuNDk5NDkzOSw1LjQ1NDI2MiAzLjEzMTcwNTcsNi4zOTY3NzYgNC4wMjE3MjcsNi42ODYzMzYgNC45NTcxNTA3LDYuOTkwNjc3IDYuMDA0NzkyNyw2LjU3NTg4MSA2LjQ0MDQzNjcsNS42ODU1NDIgYyAwLjEyODg3LC0wLjI2MzM0OCAwLjI5NjkzMywtMC4zODQ2MzIgMC41OTcwMDUsLTAuMzQ4ODYxIDAuMTYyMjQyLDAuMDE5MzMgMC4zMzA5MDUsMC4wMDI1IDAuNDk0MTM1LDAuMDAyNSBoIDAuMTc2MjEyIGwgLTAuMDM0MTgsMC4xNzI4NiBjIC0wLjE5Mzc4LDAuOTgwNjE1IC0wLjM4NzI3OSwxLjk2MTI2NSAtMC41ODA3NzcsMi45NDIwMiBsIC0wLjAyMzA0LDAuMTE2Njk5IGggLTAuNzg5NTUxIGMgLTAuNTM4MzAyLDAgLTEuMDc2Njc1LC0wLjAwMiAtMS42MTQ5NDI1LDQuOTRlLTQgLTAuOTYwODU4OSwwLjAwNDMgLTEuNzkxNDcyNiwwLjU4OTg0MyAtMi4wMjg2MDkzLDEuNTM1NTY4IC0wLjIzNjM2MDcsMC45NDI0NDQgMC4yMTY2MDUxLDEuODMyMzI0IDEuMDUyMjYzNCwyLjI5NDMyMSAwLjAzNjc5NSwwLjAyMDM2IDAuMDcwOTQ0LDAuMDQ0NDUgMC4xMDY1MDM0LDAuMDY2ODIgbCAwLjA4ODMsMC4wNTU2IC0wLjAyNDkwNiwwLjEwMTQyNCBjIC0wLjE2MDEyNTUsMC42NTE1NzkgLTAuMzE4ODc1MiwxLjMwMzYxNyAtMC40Nzk5NTMyLDEuOTU0OTg1IC0wLjIwNDM2MzgsMC44MjYxNjggLTAuNDA2MjU4MSwxLjY1MzAwNyAtMC42MjEwMjg4LDIuNDc2NTMgLTAuMDM1OTgzLDAuMTM3Njg5IC0wLjE0NDk5MTQsMC4zMDA0OTUgLTAuMjgwMjgxNCwwLjM1NTQyMyAtMC43MDQ2MDE3LDAuMjg1ODkgLTEuMTQyNjA5NywwLjc4MDUxOSAtMS4zMDg5Nzk0LDEuNTI1OTM3IC0wLjAwODI1LDAuMDM2ODMgLTAuMDIxODM3LDAuMDYwNzggLTAuMDM5MDg4LDAuMDg5MzIgdiAxLjg5NjEwNyBjIDAuMDE5MTkxLDAuMDI5NzcgMC4wMzg0NTMsMC4wNTkzNyAwLjA1NTI0NSwwLjA5MDczIDAuMTIzNzE5LDAuMjMwMTg3IDAuMzc1MTc4NSwwLjM4NzM0OSAwLjY0MDAwODIsMC4zMjQyMzcgMC4yNzg5MDU2LC0wLjA2NjQ2IDAuNDU1ODIzMywtMC4yODc0NzggMC40NjAyMzMsLTAuNTc0MDc0IDAuMDA2OTUsLTAuNDQ5NDAzIDcuMDU1ZS00LC0wLjg5ODgwNSAwLjAwMjQ3LC0xLjM0ODEzOCAwLjAwMTc2LC0wLjUyMDY5OSAwLjMyMjc5MTEsLTAuOTYxMTc2IDAuODczMjI5MSwtMC45NTc4NiAwLjU1MjA2MDksMC4wMDM1IDAuODYxMzc1OCwwLjQ0NzE0NSAwLjg2Mjc1MTcsMC45NjY5MjcgMC4wMDEwNiwwLjQzMzU5OCAtMC4wMDI0NywwLjg2NzIzMiAwLjAwMTA2LDEuMzAwODY1IDAuMDAyODIsMC4zNDA3ODMgMC4yMjI4ODQ2LDAuNjI1MjI3IDAuNTc5MzMwNSwwLjYyNDI3NSAwLjM1Nzc1MTMsLTAuMDAxMSAwLjU3MzI2MjMsLTAuMjg3NjIgMC41NzY2MTQzLC0wLjYyODMzMiAwLjAwMzUsLTAuMzYzMzI1IC0wLjAxMzU1LC0wLjcyNjg5NyAwLjAwMzcsLTEuMDkwMDEgMC4wNDY0MiwtMC45NzcxMjIgLTAuMzM4MzQ4OCwtMS43MTM2MTUgLTEuMjEzNjk0NSwtMi4xNzAwMzggbCAtMC4xMDEwMzU0LC0wLjA1MjcgMC4wMjczNCwtMC4xMTA1MjUgYyAwLjEzODIxODEsLTAuNTU4NDExIDAuMjc3MDM1OSwtMS4xMTY2MSAwLjQxNTUzNjIsLTEuNjc0OTg1IDAuMjIyMDAyNiwtMC44OTQ1NzMgMC40NTAzMTk5LC0xLjc4NzczNCAwLjY2MDk5ODcsLTIuNjg1MTYzIDAuMDU1MDcsLTAuMjM0NTI2IDAuMTgwMzA0LC0wLjMyNjAzNyAwLjQxOTQ4NywtMC4zMjA2MDQgMC40NzYxNzksMC4wMTA4NyAwLjk1MjQ2MywwLjAwMzkgMS40Mjg3MTIsMC4wMDM5IGggMC4xNDQ3OCB2IDAuNDMzMTA0IGMgMCwyLjUyMjg4NiAtMy41M2UtNCw1LjA0NTY2NSAwLDcuNTY4NTUgMi4xMWUtNCwxLjMyOTY1MiAwLjg1MTc0NSwyLjE3MzQ2IDIuMTc5NDU3LDIuMTc0Mzc3IDAuMTk2MDM4LDEuNDFlLTQgMC4zOTIxMTEsNy4xZS01IDAuNTg4MTQ5LDcuMWUtNSBoIDAuMTQ0NzggdiAwLjE0NDc3OSBjIDAsMC4zMjU1NDMgLTAuMDM5MDksMC42NjA1NzUgMC4wMDU2LDAuOTgzODYgMC4xMjY0NzAzLDAuOTE1MzE2IDAuNzM5Mjc5MywxLjUyOTY3NyAxLjYzMjU0NjMsMS43Mjc0NDQgMC4wMzg2NiwwLjAwODYgMC4wNzE5LDAuMDIzMTEgMC4xMDc1MjcsMC4wMzc2OCB6IE0gOS43MTU3NDY3LDIxLjY0MDQzNiBjIC0wLjIzOTQ2NSwwIC0wLjQ3OTAwMSwwLjAwNTIgLTAuNzE4Mzk1LC0wLjAwMTEgLTAuNTAxMzY3LC0wLjAxMzI2IC0wLjg1OTA0OCwtMC4zNzc5NjUgLTAuODcyNjY1LC0wLjg3NzYwMyAtMC4wMDM1LC0wLjEyOTc4NyAtNy4wNWUtNCwtMC4yNTk2NDQgLTcuMDVlLTQsLTAuMzg5NTM3IDAsLTMuMzkxMDM0IDAsLTYuNzgyMTA0IDAsLTEwLjE3MzEzOCBWIDkuNzQ2OTc0IEggMTguNTQyOTcgdiAwLjM5Mjg1MyBjIDAsMy40OTU1MjcgMS40MmUtNCw2Ljk5MTAxOCAwLDEwLjQ4NjU0NSAwLDAuNjc1NjA0IC0wLjMzNDcxNCwxLjAxMzMxNyAtMS4wMTEwNTksMS4wMTQyNyAtMC4xOTM1NjgsMi44MmUtNCAtMC4zODcxMzcsMCAtMC41ODA3MDYsMCBoIC0wLjE0NDc4IHYgLTAuNDE2OTgzIGMgMCwtMS4wNzY3MTEgMC4wMDExLC0yLjE1MzM4NiAtMy41MmUtNCwtMy4yMzAxMzMgLTAuMDAxOCwtMS4yODE3NDUgLTAuODU5NjgzLC0yLjEzODM5MyAtMi4xNDEyMTYsLTIuMTQwMDUxIC0wLjg5OTk3LC0wLjAwMTEgLTEuNzk5OTA0LC0wLjAwMjEgLTIuNjk5ODAzLDMuNTNlLTQgLTEuMjMyMDc0LDAuMDAzNSAtMi4xMDA5NjQzLDAuODczMjI5IC0yLjEwNDAzMzMsMi4xMDUwOTEgLTAuMDAyNSwxLjA4NDc5IC0zLjUzZS00LDIuMTY5NDczIC0zLjUzZS00LDMuMjU0MjYzIHYgMC40MjcyODkgeiBNIDE4LjM4ODc3Miw4LjU2MDU5MSBIIDguMjU1Nzc4NyBsIDAuMDMzNDQsLTAuMTcyMzY3IGMgMC4xMDg0NDQsLTAuNTU5MjIzIDAuMjE2MDc2LC0xLjExODU4NiAwLjMyNjcwNywtMS42NzcyNzkgMC4xNTU4NTcsLTAuNzg3MjU3IDAuMzEyMjc5LC0xLjU3NDM3NCAwLjQ3MTkxLC0yLjM2MDgxOSAwLjIzMTM1MSwtMS4xNDAxNDEgMS4xNDY1OTYzLC0xLjg5OTY3IDIuMzExOTI1MywtMS45MDM1ODYgMS4yODU4MDIsLTAuMDA0MyAyLjU3MTY3NCwtMC4wMDM4IDMuODU3NDc2LC03ZS01IDEuMTg0MjM3LDAuMDAzNSAyLjA4OTE4MSwwLjc2MDU1MiAyLjMyMzIxMywxLjkxODE1NSAwLjI1NTk3NiwxLjI2NjE1MiAwLjUwNjM3NywyLjUzMzUwNCAwLjc1ODM2NSwzLjgwMDUzOCAwLjAxNTM1LDAuMDc3MTIgMC4wMjAxOCwwLjE1NTAxIDAuMDI5ODEsMC4yMzI4MzMgeiBtIC0yLjc1MTQxNSwxMS4zNjAxOTggdiAxLjcwNzYxNyBoIC00LjYwMDI0OCB2IC0xLjcwNzYxNyB6IG0gMC4wMTAzNCwtMS4xNzc3MTEgaCAtNC42MDI3ODkgdiAtMC4xNDQ3OCBjIDAsLTAuMzA4NDY4IC0wLjAzNjE5LC0wLjYxNTQ1NSAwLjAxMTI5LC0wLjkyMjY4OSAwLjA2MjYyLC0wLjQwNTU1MiAwLjQyMTgxNiwtMC42NTk5NzUgMC44MTk4ODksLTAuNjYyNTE1IDAuOTcxOTM3LC0wLjAwNjIgMS45NDM5MDgsLTAuMDA3MyAyLjkxNTgwOSw3LjA2ZS00IDAuNDc1Njg0LDAuMDAzOCAwLjgzNjI1OCwwLjM3MjYwMyAwLjg1NDAwMywwLjg0MzcwMSAwLjAwOTMsMC4yNDY5NDQgMC4wMDE4LDAuNDkzOTIzIDAuMDAxOCwwLjc0MDkzOCB6IG0gLTQuNjI5NjM1LDQuMDYzMDM5IGggNC42MjAwNzQgdiAwLjE0NDc4IGMgMCwwLjI4NTg5IDAuMDI2LDAuNTcxMjUyIC0wLjAwNzYsMC44NTY0MDEgLTAuMDQ5MzIsMC40MTg1MzUgLTAuNDEyMjU2LDAuNzE5NzcxIC0wLjgyODQ5NywwLjcyMzE1OCAtMC45Nzk5NDQsMC4wMDggLTEuOTU5OTk0LDAuMDA5IC0yLjkzOTkzOSwtMi4xMmUtNCAtMC40NDk0MDIsLTAuMDA0MiAtMC44MDgxNDEsLTAuMzU4MDMzIC0wLjgzOTcxNSwtMC44MDI2NzMgLTAuMDEyODEsLTAuMTc5NzQgLTAuMDAzOCwtMC4zNTkzMzkgLTAuMDA0MywtMC41MzkyOTEgLTIuODJlLTQsLTAuMDc5MTMgMCwtMC4xNTgyNTUgMCwtMC4yMzczODMgeiBNIDYuOTU3MTAwNyw5LjcyODA3MSB2IDEuNzM2Mjk4IGggLTAuNDA1ODM1IGMgLTAuNjM0MDQ2LDAgLTEuMjY4MTI4LDAuMDAyNiAtMS45MDIyNDQ0LC05LjUyZS00IC0wLjQ5ODA1MDcsLTAuMDAyOCAtMC45MTIyODE2LC0wLjM1MTU3OCAtMC45MTM4NjkxLC0wLjg2NTA0NSAtMC4wMDE3NiwtMC41MTQyMDggMC40MTA4Nzk1LC0wLjg2NjczOCAwLjkxMDM3NjYsLTAuODY5MzQ5IDAuNzIyMjQwOSwtMC4wMDM3IDEuNDQ0NTUxOSwtOS41MmUtNCAyLjE2Njc5MTksLTkuNTJlLTQgeiBNIDE5LjcxMDU5MiwxMS40NjQzNjkgViA5Ljc2MjA0MyBsIDAuMTI4NDQ2LC0wLjAxNDY0IGMgMC4wNTk3MywtMC4wMDY3IDAuMTE2NDUyLC0wLjAxODMxIDAuMTc3MDU5LC0wLjAxODQ1IDAuNjUwMDYyLC0wLjAwMTIgMS4zMDAxOTUsLTAuMDAzMiAxLjk1MDI1OCwwIDAuNDk5OTIsMC4wMDI1IDAuOTEzMzM5LDAuMzQ1MjI4IDAuOTE2ODMyLDAuODYxNTE3IDAuMDAzNSwwLjUxNDYzMSAtMC40MDY4MjMsMC44Njk3MDEgLTAuOTA3MzQzLDAuODcyNjY1IC0wLjcwNjgyNCwwLjAwNDIgLTEuNDEzNjQ4LDAuMDAxMiAtMi4xMjA0NzIsMC4wMDEyIHogTSA1LjUxODI2MzcsNC43Njg0ODQgYyAtMC4wMDQ1LDAuNDY5NDQgLTAuMzk4NTY3LDAuODU5NzE4IC0wLjg2ODE4NDEsMC44NTk0IEMgNC4xNzEwMDgzLDUuNjI3NjAyIDMuNzcwOTk0NCw1LjIxNjkzNCAzLjc4MzQ0NzQsNC43Mzc5MzMgMy43OTU2ODg0LDQuMjY5NDgxIDQuMTk3NTcyNCwzLjg4NDYwMSA0LjY2NjE2NjIsMy44OTMwNjggNS4xMzU4MTg3LDMuOTAxNTY4IDUuNTIyNzQ0Nyw0LjI5ODUxNCA1LjUxODI2MzcsNC43Njg0ODQgWiBNIDIyLjg4MzE4Nyw0Ljc0NjQwNCBjIDAuMDA3OCwwLjQ2OTQ0IC0wLjM3NzA4NCwwLjg2OTM0OSAtMC44NDYwMywwLjg4MTQ4NCAtMC40Nzk4MTIsMC4wMTIzOCAtMC44ODg4OTMsLTAuMzg4MzcyIC0wLjg4ODgyMiwtMC44Njc4NjcgNy4xZS01LC0wLjQ2OTQ3NiAwLjM5MTE5NSwtMC44NjMyODEgMC44NjA2LC0wLjg2Njk0OSAwLjQ2OTU4MSwtMC4wMDM3IDAuODY2NDIsMC4zODM4OTIgMC44NzQyNTIsMC44NTMzMzIgeiBtIC0xMS44NjYyMjIsNy4yOTM5ODQgYyAtMC4wMDE0LC0wLjMxMTM2MSAtMC4yNjQyMywtMC41NzM3NTcgLTAuNTc1NDg1LC0wLjU3NTEzMyAtMC4zMTExNDksLTAuMDAxNCAtMC41NzY0MDIzLDAuMjU5MzYyIC0wLjU4MDA3MTMsMC41NzA0NzYgLTAuMDAzOCwwLjMxODAyOSAwLjI2NjQ1MjMsMC41ODkzNDkgMC41ODQ3NjMzLDAuNTg1MjIyIDAuMzExNTAyLC0wLjAwNCAwLjU3MjA5OSwtMC4yNjg5OTMgMC41NzA3OTMsLTAuNTgwNTY1IHogbSAyLjg5NDA3OCw4LjQ2ZS00IGMgLTcuMDZlLTQsLTAuMzExNjA4IC0wLjI2MzI3OCwtMC41NzQzMjEgLTAuNTc0ODUxLC0wLjU3NTk3OSAtMC4zMTEwNDMsLTAuMDAxNyAtMC41NzY3MiwwLjI1ODg2OCAtMC41ODA3NzYsMC41Njk5MTIgLTAuMDA0MSwwLjMxODA5OSAwLjI2NTg4OCwwLjU4OTYzMSAwLjU4NDI2OSwwLjU4NTc4NiAwLjMxMTM2MSwtMC4wMDM4IDAuNTcyMjQsLTAuMjY4Mjg3IDAuNTcxMzU4LC0wLjU3OTcxOSB6IG0gMi4zMjM4ODMsMC41Nzk3MTkgYyAwLjMxMTQzMiwtMC4wMDQyIDAuNTcxNzQ2LC0wLjI2OTM4MSAwLjU3MDMsLTAuNTgwNzc3IC0wLjAwMTQsLTAuMzExNDMyIC0wLjI2NDM3MSwtMC41NzQwMDQgLTAuNTc1NzMyLC0wLjU3NTA5NyAtMC4zMTgyMDUsLTAuMDAxMSAtMC41ODY4NDUsMC4yNzE5MiAtMC41Nzk4MjUsMC41OTAxMjUgMC4wMDY4LDAuMzEwNjU2IDAuMjc0MzU1LDAuNTcwMDE3IDAuNTg1MjU3LDAuNTY1NzQ5IHogTSAxMi40NjQ1NTEsNS40ODM4NDUgYyAwLC0wLjIzOTA0MiAwLjAwNTYsLTAuNDc4MTU0IC0wLjAwMTEsLTAuNzE3MDkgLTAuMDA5MSwtMC4zMjA0OTggLTAuMjQ1MzkyLC0wLjU4MTMwNiAtMC41NzI0NTIsLTAuNTg0MTI4IC0wLjMzNjc2MSwtMC4wMDI5IC0wLjU3NzAzNywwLjI2NDU4MyAtMC41ODE1MTgsMC41OTM5IC0wLjAwNjQsMC40NzE0NTEgLTAuMDA2NCwwLjk0MzAwOSAwLDEuNDE0NDk1IDAuMDA0NSwwLjMyOTMxOCAwLjI0NDY4NywwLjU5NzIxNiAwLjU4MTUxOCwwLjU5NDMyNCAwLjMyNjk4OSwtMC4wMDI4IDAuNTYzMjc5LC0wLjI2NDA4OSAwLjU3MjQ1MiwtMC41ODQzNCAwLjAwNjksLTAuMjM4OTcxIDAuMDAxMSwtMC40NzgxMTkgMC4wMDExLC0wLjcxNzE2MSB6IG0gMi44OTM3OTUsMC4wMDE3IGMgLTMuNTNlLTQsLTAuMjQ2NDg2IDAuMDA4LC0wLjQ5MzI1MyAtMC4wMDE4LC0wLjczOTY2OCAtMC4wMTIzOCwtMC4zMTA2NTUgLTAuMjU2NjgxLC0wLjU1OTg5MiAtMC41NzAxNTgsLTAuNTYzMjc5IC0wLjMyMDYwNCwtMC4wMDM1IC0wLjU3NTM0NCwwLjI0OTk0MyAtMC41ODE3MywwLjU2OTEzNSAtMC4wMDk4LDAuNDg2OTAzIC0wLjAwOTYsMC45NzQwMTggLTEuNDFlLTQsMS40NjA5OTEgMC4wMDYyLDAuMzE5Mjk5IDAuMjU3NzA0LDAuNTc0Njc0IDAuNTc5MzY2LDAuNTcyNTkzIDAuMzI2NDYsLTAuMDAyMSAwLjU2NDEyNiwtMC4yNjI5OTYgMC41NzM2MTYsLTAuNTgyOTY0IDAuMDA3MiwtMC4yMzg3OTUgMC4wMDE0LC0wLjQ3NzgzNyAwLjAwMTEsLTAuNzE2ODA4IHoiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDowLjM1Mjc3NztmaWxsLW9wYWNpdHk6MSIKICAgICAgIGlkPSJwYXRoMTYiIC8+CiAgPC9nPgo8L3N2Zz4K';
/**
 * Icon svg to be displayed in the category menu, encoded as a data URI.
 * @type {string}
 */
// eslint-disable-next-line max-len
const menuIconURI = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB3aWR0aD0iMTAyIgogICBoZWlnaHQ9IjEwMiIKICAgdmlld0JveD0iMCAwIDI2Ljk4NzUgMjYuOTg3NSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnMzM4IgogICBpbmtzY2FwZTp2ZXJzaW9uPSIxLjIuMiAoYjBhODQ4NjU0MSwgMjAyMi0xMi0wMSkiCiAgIHNvZGlwb2RpOmRvY25hbWU9ImRyYXdpbmczLnN2ZyIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9Im5hbWVkdmlldzM0MCIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnNob3dwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZWNoZWNrZXJib2FyZD0iMCIKICAgICBpbmtzY2FwZTpkZXNrY29sb3I9IiNkMWQxZDEiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9Im1tIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSI0LjM4OTMzOTUiCiAgICAgaW5rc2NhcGU6Y3g9IjEzNS43ODM1MyIKICAgICBpbmtzY2FwZTpjeT0iNzcuMTE4NjY0IgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTkyMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDUyIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjEiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIiAvPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMzMzUiIC8+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIGQ9Im0gMTEuNjI0NTUzLDI1LjY5MTY5MiBoIDMuNDI0OTAxIGMgMC4xMzYxMDIsLTAuMDM4OCAwLjI3NDI4NSwtMC4wNzE5NyAwLjQwNzcwNSwtMC4xMTk1MiAwLjc5NzM4MiwtMC4yODQxNjIgMS4zMjg4MDUsLTEuMDIyODA3IDEuMzQ3MTE0LC0xLjg2ODgzNyAwLjAwNTYsLTAuMjU4NDQ0IDcuMDZlLTQsLTAuNTE2OTYgNy4wNmUtNCwtMC43NzUzNjkgdiAtMC4xNDQ3NzkgaCAwLjE0NDc4IGMgMC4zMTg4MDQsMCAwLjY0NTUxMSwwLjAzNjQxIDAuOTYyNDExLC0wLjAwNDkgMS4wNzU4NjQsLTAuMTQwMTU5IDEuNzg1MzY5LC0wLjk4MzQwMiAxLjc4Njk1NywtMi4wNjEwMyAwLjAwMzgsLTIuNTQ3NTQ0IDAuMDAxMSwtNS4wOTUxOTUgMC4wMDExLC03LjY0MjczOSB2IC0wLjQ1MTk0MyBoIDAuMTQ0NzggYyAwLjUwNDA0OCwwIDEuMDA4MTY2LC0wLjAwMzUgMS41MTIyNDksMC4wMDU5IDAuMTE4NzEsMC4wMDIzIDAuMjM4MDksMC4xMjgzMDUgMC4yNjY3MzUsMC4yMzgyNjYgMC4zNzIzOTIsMS40MjkwMjkgMC43NDA3OTcsMi44NTkxODcgMS4wOTk4NTMsNC4yOTE2MzkgMC4wMzE5NiwwLjEyNzYzNCAtMC4wNTc3MSwwLjMwODQ2OCAtMC4xNjgzMSwwLjM3NDY4NCAtMC43MTgxMTMsMC40MyAtMS4wNzQ5NDcsMS4wNDg0NTQgLTEuMDcwNzQ5LDEuODg3MTQ2IDAuMDAyMSwwLjQzMzg0NSAtMC4wMDIxLDAuODY3NjkgMC4wMDExLDEuMzAxNTM2IDAuMDAyNSwwLjM0MDc4MiAwLjIxODY4NiwwLjYyNzU5IDAuNTc2Mjk2LDAuNjI4NTQzIDAuMzU2OTA1LDAuMDAxMSAwLjU3NjM2NywtMC4yODM4NDUgMC41Nzk0MDEsLTAuNjI0ODA0IDAuMDA0MSwtMC40NDk5NjcgLTAuMDAxNCwtMC45MDAwMDUgMC4wMDE4LC0xLjM1MDAwNyAwLjAwMzYsLTAuNDk5OTkxIDAuMzQ2MjUxLC0wLjkxNDc4NiAwLjg2MzI0NiwtMC45MTczMjYgMC41MTU4NjYsLTAuMDAyNSAwLjg2NzE2MSwwLjQxMDMxNSAwLjg3MTY0MSwwLjkxMDUxNyAwLjAwNDEsMC40NTAxNDQgLTAuMDAxNCwwLjkwMDMyMyAwLjAwMTgsMS4zNTA0NjYgMC4wMDI1LDAuMzQxMTcxIDAuMjE1Nzk0LDAuNjI4Njg0IDAuNTc0MjUxLDAuNjMxMTU0IDAuMzUzOTc2LDAuMDAyNSAwLjU4MjIyMywtMC4yNzgxMyAwLjU4MDE0MiwtMC42MTk5MzYgLTAuMDAzNiwtMC41ODY1OTcgMC4wMjkzOSwtMS4xNzg1MjIgLTAuMDQ2NTMsLTEuNzYxOTA5IC0wLjA5NzE1LC0wLjc0NzAwNiAtMC41NTk1MDQsLTEuMjQzMzk4IC0xLjI0MjU4NiwtMS41MjI1ODYgLTAuMjAyNDk0LC0wLjA4MjgzIC0wLjMwMjQwMSwtMC4yMDQyMjMgLTAuMzU1NiwtMC40MTUyNTQgLTAuMzUzMDI0LC0xLjQwMDE3MiAtMC43MTUxNDksLTIuNzk4MDg3IC0xLjA3NDAyOSwtNC4xOTY4MTMgLTAuMDE4MSwtMC4wNzA2NiAtMC4wMjg2MSwtMC4xNDI1NTcgLTAuMDQyNjUsLTAuMjEzOTk0IGwgLTAuMDE4NjYsLTAuMDk1MDQgMC4wODA3MiwtMC4wNTM1MiBjIDAuMTQ2Mjk3LC0wLjA5NzA1IDAuMzAxMzQyLC0wLjE4MzcyNiAwLjQzOTM4NCwtMC4yOTI1MjIgMC42NjI3MjcsLTAuNTIyNTY5IDAuOTI5MTQ0LC0xLjQyNTAwOCAwLjY2MTY2OSwtMi4yMjQ3NTQgLTAuMjY4Mjg3LC0wLjgwMTk2OCAtMS4wMTc5NzQsLTEuMzY1MDcxIC0xLjg2NjE1NiwtMS4zNzk1NyAtMC42OTA0NTUsLTAuMDExNzggLTEuMzgxMDg3LC0wLjAwMyAtMi4wNzE2MTMsLTAuMDAzNiAtMC4wOTM4NywtNy4xZS01IC0wLjE4Nzg1MywwIC0wLjI4MTcyNywwIEggMTkuNTk3ODMzIEwgMTkuNTc0NjUzLDguNDU0MjMzIEMgMTkuMzc5ODQ5LDcuNDczOTM2IDE5LjE4NTkyOCw2LjQ5MzQ2MyAxOC45OTE0NzcsNS41MTMwOTUgTCAxOC45NTcxNDcsNS4zNDAwOTQgSCAxOS4xMzM1IGMgMC4yNTYxMTYsMCAwLjUxMjM3MywtMC4wMTQyMiAwLjc2Nzk5NiwwLjAwOTkgMC4xMzc2ODksMC4wMTMwMiAwLjIyNzIyMywwLjE2NTYyOCAwLjI4MTg2OSwwLjI3Nzc0MSAwLjM2Nzg0LDAuNzU1MDQ5IDEuMTc4OTQ1LDEuMjM4MTc3IDIuMDIxMjAxLDEuMTUxMTQ3IDAuODU0MjE0LC0wLjA4ODIzIDEuNTY2OTY1LC0wLjY5NTQzIDEuNzc2NTUsLTEuNTMwMTcxIEMgMjQuMjI4NjI0LDQuMjYzMjY0IDIzLjY3ODUwMywzLjIyMTg2NiAyMi43MjY4ODcsMi44Njc0MzEgMjEuNzYyNDMsMi41MDgzMDQgMjAuNjY0NjIzLDIuOTIyODkxIDIwLjIxNTE1LDMuODU3MTQ3IDIwLjA5NTc3LDQuMTA1MjIgMTkuOTM2MjQ0LDQuMjAwOTk5IDE5LjY2MTAwNyw0LjE4NTMgMTkuMzkxNDg2LDQuMTY5OTUgMTkuMTIxMTE3LDQuMTgyIDE4Ljg1MTMxNCw0LjE4MiBoIC0wLjExMTQ3OCBsIC0wLjAyODUsLTAuMTA3NzAzIGMgLTAuMDI1NzksLTAuMDk3NDQgLTAuMDQ5MjUsLTAuMTk1NDM4IC0wLjA3NzI2LC0wLjI5MjMxMSAtMC40MTQ1ODMsLTEuNDI5ODQgLTEuNzQ5NTI3LC0yLjQ2NjMzNTEgLTMuMjQxNzc0LC0yLjQ4Nzc0ODEgLTEuMzQxMzI5LC0wLjAxOTI2IC0yLjY4Mjc5OSwtMC4wMTI5OCAtNC4wMjQwOTMsLTAuMDAzOCAtMS42MTMxNDQzLDAuMDExMDggLTIuOTQwNDMyMywxLjA1NTc5MTEgLTMuMzYyMzE4MywyLjYwNzc5OTEgLTAuMDE2NzksMC4wNjE3NCAtMC4wMzg1MiwwLjEyMTc0MyAtMC4wNTc5MywwLjE4MjU2MiBsIC0wLjAzMjIxLDAuMTAwNjgyIGggLTAuMTA1NjkyIGMgLTAuMzM4Mjc4LDAgLTAuNjc2Njk3LDAuMDA5MyAtMS4wMTQ2OTMsLTAuMDA4NCBDIDYuNjYyMjI3Nyw0LjE2NjE4MSA2LjU1MjE5NjcsNC4wMjg0NDMgNi40OTU1NDA3LDMuOTE4Njk0IDYuMTAwMTQ4NywzLjE1MjY3NCA1LjQ4NzE5ODcsMi43Mzk4MTkgNC42MTY1MDkxLDIuNzM5NjA3IDMuNTg1OTQxNCwyLjczOTMyNSAyLjc4NzMyNDcsMy41MTc0NDUgMi42Mzg2OTk3LDQuNTE3Mjg2IDIuNDk5NDkzOSw1LjQ1NDI2MiAzLjEzMTcwNTcsNi4zOTY3NzYgNC4wMjE3MjcsNi42ODYzMzYgNC45NTcxNTA3LDYuOTkwNjc3IDYuMDA0NzkyNyw2LjU3NTg4MSA2LjQ0MDQzNjcsNS42ODU1NDIgYyAwLjEyODg3LC0wLjI2MzM0OCAwLjI5NjkzMywtMC4zODQ2MzIgMC41OTcwMDUsLTAuMzQ4ODYxIDAuMTYyMjQyLDAuMDE5MzMgMC4zMzA5MDUsMC4wMDI1IDAuNDk0MTM1LDAuMDAyNSBoIDAuMTc2MjEyIGwgLTAuMDM0MTgsMC4xNzI4NiBjIC0wLjE5Mzc4LDAuOTgwNjE1IC0wLjM4NzI3OSwxLjk2MTI2NSAtMC41ODA3NzcsMi45NDIwMiBsIC0wLjAyMzA0LDAuMTE2Njk5IGggLTAuNzg5NTUxIGMgLTAuNTM4MzAyLDAgLTEuMDc2Njc1LC0wLjAwMiAtMS42MTQ5NDI1LDQuOTRlLTQgLTAuOTYwODU4OSwwLjAwNDMgLTEuNzkxNDcyNiwwLjU4OTg0MyAtMi4wMjg2MDkzLDEuNTM1NTY4IC0wLjIzNjM2MDcsMC45NDI0NDQgMC4yMTY2MDUxLDEuODMyMzI0IDEuMDUyMjYzNCwyLjI5NDMyMSAwLjAzNjc5NSwwLjAyMDM2IDAuMDcwOTQ0LDAuMDQ0NDUgMC4xMDY1MDM0LDAuMDY2ODIgbCAwLjA4ODMsMC4wNTU2IC0wLjAyNDkwNiwwLjEwMTQyNCBjIC0wLjE2MDEyNTUsMC42NTE1NzkgLTAuMzE4ODc1MiwxLjMwMzYxNyAtMC40Nzk5NTMyLDEuOTU0OTg1IC0wLjIwNDM2MzgsMC44MjYxNjggLTAuNDA2MjU4MSwxLjY1MzAwNyAtMC42MjEwMjg4LDIuNDc2NTMgLTAuMDM1OTgzLDAuMTM3Njg5IC0wLjE0NDk5MTQsMC4zMDA0OTUgLTAuMjgwMjgxNCwwLjM1NTQyMyAtMC43MDQ2MDE3LDAuMjg1ODkgLTEuMTQyNjA5NywwLjc4MDUxOSAtMS4zMDg5Nzk0LDEuNTI1OTM3IC0wLjAwODI1LDAuMDM2ODMgLTAuMDIxODM3LDAuMDYwNzggLTAuMDM5MDg4LDAuMDg5MzIgdiAxLjg5NjEwNyBjIDAuMDE5MTkxLDAuMDI5NzcgMC4wMzg0NTMsMC4wNTkzNyAwLjA1NTI0NSwwLjA5MDczIDAuMTIzNzE5LDAuMjMwMTg3IDAuMzc1MTc4NSwwLjM4NzM0OSAwLjY0MDAwODIsMC4zMjQyMzcgMC4yNzg5MDU2LC0wLjA2NjQ2IDAuNDU1ODIzMywtMC4yODc0NzggMC40NjAyMzMsLTAuNTc0MDc0IDAuMDA2OTUsLTAuNDQ5NDAzIDcuMDU1ZS00LC0wLjg5ODgwNSAwLjAwMjQ3LC0xLjM0ODEzOCAwLjAwMTc2LC0wLjUyMDY5OSAwLjMyMjc5MTEsLTAuOTYxMTc2IDAuODczMjI5MSwtMC45NTc4NiAwLjU1MjA2MDksMC4wMDM1IDAuODYxMzc1OCwwLjQ0NzE0NSAwLjg2Mjc1MTcsMC45NjY5MjcgMC4wMDEwNiwwLjQzMzU5OCAtMC4wMDI0NywwLjg2NzIzMiAwLjAwMTA2LDEuMzAwODY1IDAuMDAyODIsMC4zNDA3ODMgMC4yMjI4ODQ2LDAuNjI1MjI3IDAuNTc5MzMwNSwwLjYyNDI3NSAwLjM1Nzc1MTMsLTAuMDAxMSAwLjU3MzI2MjMsLTAuMjg3NjIgMC41NzY2MTQzLC0wLjYyODMzMiAwLjAwMzUsLTAuMzYzMzI1IC0wLjAxMzU1LC0wLjcyNjg5NyAwLjAwMzcsLTEuMDkwMDEgMC4wNDY0MiwtMC45NzcxMjIgLTAuMzM4MzQ4OCwtMS43MTM2MTUgLTEuMjEzNjk0NSwtMi4xNzAwMzggbCAtMC4xMDEwMzU0LC0wLjA1MjcgMC4wMjczNCwtMC4xMTA1MjUgYyAwLjEzODIxODEsLTAuNTU4NDExIDAuMjc3MDM1OSwtMS4xMTY2MSAwLjQxNTUzNjIsLTEuNjc0OTg1IDAuMjIyMDAyNiwtMC44OTQ1NzMgMC40NTAzMTk5LC0xLjc4NzczNCAwLjY2MDk5ODcsLTIuNjg1MTYzIDAuMDU1MDcsLTAuMjM0NTI2IDAuMTgwMzA0LC0wLjMyNjAzNyAwLjQxOTQ4NywtMC4zMjA2MDQgMC40NzYxNzksMC4wMTA4NyAwLjk1MjQ2MywwLjAwMzkgMS40Mjg3MTIsMC4wMDM5IGggMC4xNDQ3OCB2IDAuNDMzMTA0IGMgMCwyLjUyMjg4NiAtMy41M2UtNCw1LjA0NTY2NSAwLDcuNTY4NTUgMi4xMWUtNCwxLjMyOTY1MiAwLjg1MTc0NSwyLjE3MzQ2IDIuMTc5NDU3LDIuMTc0Mzc3IDAuMTk2MDM4LDEuNDFlLTQgMC4zOTIxMTEsNy4xZS01IDAuNTg4MTQ5LDcuMWUtNSBoIDAuMTQ0NzggdiAwLjE0NDc3OSBjIDAsMC4zMjU1NDMgLTAuMDM5MDksMC42NjA1NzUgMC4wMDU2LDAuOTgzODYgMC4xMjY0NzAzLDAuOTE1MzE2IDAuNzM5Mjc5MywxLjUyOTY3NyAxLjYzMjU0NjMsMS43Mjc0NDQgMC4wMzg2NiwwLjAwODYgMC4wNzE5LDAuMDIzMTEgMC4xMDc1MjcsMC4wMzc2OCB6IE0gOS43MTU3NDY3LDIxLjY0MDQzNiBjIC0wLjIzOTQ2NSwwIC0wLjQ3OTAwMSwwLjAwNTIgLTAuNzE4Mzk1LC0wLjAwMTEgLTAuNTAxMzY3LC0wLjAxMzI2IC0wLjg1OTA0OCwtMC4zNzc5NjUgLTAuODcyNjY1LC0wLjg3NzYwMyAtMC4wMDM1LC0wLjEyOTc4NyAtNy4wNWUtNCwtMC4yNTk2NDQgLTcuMDVlLTQsLTAuMzg5NTM3IDAsLTMuMzkxMDM0IDAsLTYuNzgyMTA0IDAsLTEwLjE3MzEzOCBWIDkuNzQ2OTc0IEggMTguNTQyOTcgdiAwLjM5Mjg1MyBjIDAsMy40OTU1MjcgMS40MmUtNCw2Ljk5MTAxOCAwLDEwLjQ4NjU0NSAwLDAuNjc1NjA0IC0wLjMzNDcxNCwxLjAxMzMxNyAtMS4wMTEwNTksMS4wMTQyNyAtMC4xOTM1NjgsMi44MmUtNCAtMC4zODcxMzcsMCAtMC41ODA3MDYsMCBoIC0wLjE0NDc4IHYgLTAuNDE2OTgzIGMgMCwtMS4wNzY3MTEgMC4wMDExLC0yLjE1MzM4NiAtMy41MmUtNCwtMy4yMzAxMzMgLTAuMDAxOCwtMS4yODE3NDUgLTAuODU5NjgzLC0yLjEzODM5MyAtMi4xNDEyMTYsLTIuMTQwMDUxIC0wLjg5OTk3LC0wLjAwMTEgLTEuNzk5OTA0LC0wLjAwMjEgLTIuNjk5ODAzLDMuNTNlLTQgLTEuMjMyMDc0LDAuMDAzNSAtMi4xMDA5NjQzLDAuODczMjI5IC0yLjEwNDAzMzMsMi4xMDUwOTEgLTAuMDAyNSwxLjA4NDc5IC0zLjUzZS00LDIuMTY5NDczIC0zLjUzZS00LDMuMjU0MjYzIHYgMC40MjcyODkgeiBNIDE4LjM4ODc3Miw4LjU2MDU5MSBIIDguMjU1Nzc4NyBsIDAuMDMzNDQsLTAuMTcyMzY3IGMgMC4xMDg0NDQsLTAuNTU5MjIzIDAuMjE2MDc2LC0xLjExODU4NiAwLjMyNjcwNywtMS42NzcyNzkgMC4xNTU4NTcsLTAuNzg3MjU3IDAuMzEyMjc5LC0xLjU3NDM3NCAwLjQ3MTkxLC0yLjM2MDgxOSAwLjIzMTM1MSwtMS4xNDAxNDEgMS4xNDY1OTYzLC0xLjg5OTY3IDIuMzExOTI1MywtMS45MDM1ODYgMS4yODU4MDIsLTAuMDA0MyAyLjU3MTY3NCwtMC4wMDM4IDMuODU3NDc2LC03ZS01IDEuMTg0MjM3LDAuMDAzNSAyLjA4OTE4MSwwLjc2MDU1MiAyLjMyMzIxMywxLjkxODE1NSAwLjI1NTk3NiwxLjI2NjE1MiAwLjUwNjM3NywyLjUzMzUwNCAwLjc1ODM2NSwzLjgwMDUzOCAwLjAxNTM1LDAuMDc3MTIgMC4wMjAxOCwwLjE1NTAxIDAuMDI5ODEsMC4yMzI4MzMgeiBtIC0yLjc1MTQxNSwxMS4zNjAxOTggdiAxLjcwNzYxNyBoIC00LjYwMDI0OCB2IC0xLjcwNzYxNyB6IG0gMC4wMTAzNCwtMS4xNzc3MTEgaCAtNC42MDI3ODkgdiAtMC4xNDQ3OCBjIDAsLTAuMzA4NDY4IC0wLjAzNjE5LC0wLjYxNTQ1NSAwLjAxMTI5LC0wLjkyMjY4OSAwLjA2MjYyLC0wLjQwNTU1MiAwLjQyMTgxNiwtMC42NTk5NzUgMC44MTk4ODksLTAuNjYyNTE1IDAuOTcxOTM3LC0wLjAwNjIgMS45NDM5MDgsLTAuMDA3MyAyLjkxNTgwOSw3LjA2ZS00IDAuNDc1Njg0LDAuMDAzOCAwLjgzNjI1OCwwLjM3MjYwMyAwLjg1NDAwMywwLjg0MzcwMSAwLjAwOTMsMC4yNDY5NDQgMC4wMDE4LDAuNDkzOTIzIDAuMDAxOCwwLjc0MDkzOCB6IG0gLTQuNjI5NjM1LDQuMDYzMDM5IGggNC42MjAwNzQgdiAwLjE0NDc4IGMgMCwwLjI4NTg5IDAuMDI2LDAuNTcxMjUyIC0wLjAwNzYsMC44NTY0MDEgLTAuMDQ5MzIsMC40MTg1MzUgLTAuNDEyMjU2LDAuNzE5NzcxIC0wLjgyODQ5NywwLjcyMzE1OCAtMC45Nzk5NDQsMC4wMDggLTEuOTU5OTk0LDAuMDA5IC0yLjkzOTkzOSwtMi4xMmUtNCAtMC40NDk0MDIsLTAuMDA0MiAtMC44MDgxNDEsLTAuMzU4MDMzIC0wLjgzOTcxNSwtMC44MDI2NzMgLTAuMDEyODEsLTAuMTc5NzQgLTAuMDAzOCwtMC4zNTkzMzkgLTAuMDA0MywtMC41MzkyOTEgLTIuODJlLTQsLTAuMDc5MTMgMCwtMC4xNTgyNTUgMCwtMC4yMzczODMgeiBNIDYuOTU3MTAwNyw5LjcyODA3MSB2IDEuNzM2Mjk4IGggLTAuNDA1ODM1IGMgLTAuNjM0MDQ2LDAgLTEuMjY4MTI4LDAuMDAyNiAtMS45MDIyNDQ0LC05LjUyZS00IC0wLjQ5ODA1MDcsLTAuMDAyOCAtMC45MTIyODE2LC0wLjM1MTU3OCAtMC45MTM4NjkxLC0wLjg2NTA0NSAtMC4wMDE3NiwtMC41MTQyMDggMC40MTA4Nzk1LC0wLjg2NjczOCAwLjkxMDM3NjYsLTAuODY5MzQ5IDAuNzIyMjQwOSwtMC4wMDM3IDEuNDQ0NTUxOSwtOS41MmUtNCAyLjE2Njc5MTksLTkuNTJlLTQgeiBNIDE5LjcxMDU5MiwxMS40NjQzNjkgViA5Ljc2MjA0MyBsIDAuMTI4NDQ2LC0wLjAxNDY0IGMgMC4wNTk3MywtMC4wMDY3IDAuMTE2NDUyLC0wLjAxODMxIDAuMTc3MDU5LC0wLjAxODQ1IDAuNjUwMDYyLC0wLjAwMTIgMS4zMDAxOTUsLTAuMDAzMiAxLjk1MDI1OCwwIDAuNDk5OTIsMC4wMDI1IDAuOTEzMzM5LDAuMzQ1MjI4IDAuOTE2ODMyLDAuODYxNTE3IDAuMDAzNSwwLjUxNDYzMSAtMC40MDY4MjMsMC44Njk3MDEgLTAuOTA3MzQzLDAuODcyNjY1IC0wLjcwNjgyNCwwLjAwNDIgLTEuNDEzNjQ4LDAuMDAxMiAtMi4xMjA0NzIsMC4wMDEyIHogTSA1LjUxODI2MzcsNC43Njg0ODQgYyAtMC4wMDQ1LDAuNDY5NDQgLTAuMzk4NTY3LDAuODU5NzE4IC0wLjg2ODE4NDEsMC44NTk0IEMgNC4xNzEwMDgzLDUuNjI3NjAyIDMuNzcwOTk0NCw1LjIxNjkzNCAzLjc4MzQ0NzQsNC43Mzc5MzMgMy43OTU2ODg0LDQuMjY5NDgxIDQuMTk3NTcyNCwzLjg4NDYwMSA0LjY2NjE2NjIsMy44OTMwNjggNS4xMzU4MTg3LDMuOTAxNTY4IDUuNTIyNzQ0Nyw0LjI5ODUxNCA1LjUxODI2MzcsNC43Njg0ODQgWiBNIDIyLjg4MzE4Nyw0Ljc0NjQwNCBjIDAuMDA3OCwwLjQ2OTQ0IC0wLjM3NzA4NCwwLjg2OTM0OSAtMC44NDYwMywwLjg4MTQ4NCAtMC40Nzk4MTIsMC4wMTIzOCAtMC44ODg4OTMsLTAuMzg4MzcyIC0wLjg4ODgyMiwtMC44Njc4NjcgNy4xZS01LC0wLjQ2OTQ3NiAwLjM5MTE5NSwtMC44NjMyODEgMC44NjA2LC0wLjg2Njk0OSAwLjQ2OTU4MSwtMC4wMDM3IDAuODY2NDIsMC4zODM4OTIgMC44NzQyNTIsMC44NTMzMzIgeiBtIC0xMS44NjYyMjIsNy4yOTM5ODQgYyAtMC4wMDE0LC0wLjMxMTM2MSAtMC4yNjQyMywtMC41NzM3NTcgLTAuNTc1NDg1LC0wLjU3NTEzMyAtMC4zMTExNDksLTAuMDAxNCAtMC41NzY0MDIzLDAuMjU5MzYyIC0wLjU4MDA3MTMsMC41NzA0NzYgLTAuMDAzOCwwLjMxODAyOSAwLjI2NjQ1MjMsMC41ODkzNDkgMC41ODQ3NjMzLDAuNTg1MjIyIDAuMzExNTAyLC0wLjAwNCAwLjU3MjA5OSwtMC4yNjg5OTMgMC41NzA3OTMsLTAuNTgwNTY1IHogbSAyLjg5NDA3OCw4LjQ2ZS00IGMgLTcuMDZlLTQsLTAuMzExNjA4IC0wLjI2MzI3OCwtMC41NzQzMjEgLTAuNTc0ODUxLC0wLjU3NTk3OSAtMC4zMTEwNDMsLTAuMDAxNyAtMC41NzY3MiwwLjI1ODg2OCAtMC41ODA3NzYsMC41Njk5MTIgLTAuMDA0MSwwLjMxODA5OSAwLjI2NTg4OCwwLjU4OTYzMSAwLjU4NDI2OSwwLjU4NTc4NiAwLjMxMTM2MSwtMC4wMDM4IDAuNTcyMjQsLTAuMjY4Mjg3IDAuNTcxMzU4LC0wLjU3OTcxOSB6IG0gMi4zMjM4ODMsMC41Nzk3MTkgYyAwLjMxMTQzMiwtMC4wMDQyIDAuNTcxNzQ2LC0wLjI2OTM4MSAwLjU3MDMsLTAuNTgwNzc3IC0wLjAwMTQsLTAuMzExNDMyIC0wLjI2NDM3MSwtMC41NzQwMDQgLTAuNTc1NzMyLC0wLjU3NTA5NyAtMC4zMTgyMDUsLTAuMDAxMSAtMC41ODY4NDUsMC4yNzE5MiAtMC41Nzk4MjUsMC41OTAxMjUgMC4wMDY4LDAuMzEwNjU2IDAuMjc0MzU1LDAuNTcwMDE3IDAuNTg1MjU3LDAuNTY1NzQ5IHogTSAxMi40NjQ1NTEsNS40ODM4NDUgYyAwLC0wLjIzOTA0MiAwLjAwNTYsLTAuNDc4MTU0IC0wLjAwMTEsLTAuNzE3MDkgLTAuMDA5MSwtMC4zMjA0OTggLTAuMjQ1MzkyLC0wLjU4MTMwNiAtMC41NzI0NTIsLTAuNTg0MTI4IC0wLjMzNjc2MSwtMC4wMDI5IC0wLjU3NzAzNywwLjI2NDU4MyAtMC41ODE1MTgsMC41OTM5IC0wLjAwNjQsMC40NzE0NTEgLTAuMDA2NCwwLjk0MzAwOSAwLDEuNDE0NDk1IDAuMDA0NSwwLjMyOTMxOCAwLjI0NDY4NywwLjU5NzIxNiAwLjU4MTUxOCwwLjU5NDMyNCAwLjMyNjk4OSwtMC4wMDI4IDAuNTYzMjc5LC0wLjI2NDA4OSAwLjU3MjQ1MiwtMC41ODQzNCAwLjAwNjksLTAuMjM4OTcxIDAuMDAxMSwtMC40NzgxMTkgMC4wMDExLC0wLjcxNzE2MSB6IG0gMi44OTM3OTUsMC4wMDE3IGMgLTMuNTNlLTQsLTAuMjQ2NDg2IDAuMDA4LC0wLjQ5MzI1MyAtMC4wMDE4LC0wLjczOTY2OCAtMC4wMTIzOCwtMC4zMTA2NTUgLTAuMjU2NjgxLC0wLjU1OTg5MiAtMC41NzAxNTgsLTAuNTYzMjc5IC0wLjMyMDYwNCwtMC4wMDM1IC0wLjU3NTM0NCwwLjI0OTk0MyAtMC41ODE3MywwLjU2OTEzNSAtMC4wMDk4LDAuNDg2OTAzIC0wLjAwOTYsMC45NzQwMTggLTEuNDFlLTQsMS40NjA5OTEgMC4wMDYyLDAuMzE5Mjk5IDAuMjU3NzA0LDAuNTc0Njc0IDAuNTc5MzY2LDAuNTcyNTkzIDAuMzI2NDYsLTAuMDAyMSAwLjU2NDEyNiwtMC4yNjI5OTYgMC41NzM2MTYsLTAuNTgyOTY0IDAuMDA3MiwtMC4yMzg3OTUgMC4wMDE0LC0wLjQ3NzgzNyAwLjAwMTEsLTAuNzE2ODA4IHoiCiAgICAgICBzdHlsZT0iZmlsbDojMWIxOTE4O2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDowLjM1Mjc3NyIKICAgICAgIGlkPSJwYXRoMTYiIC8+CiAgPC9nPgo8L3N2Zz4K';

/**
 * The list of USB device filters.
 * @readonly
 */
const PNPID_LIST = [
    // Arduino UNO
    'USB\\VID_2341&PID_0043',
    // For chinese clones that use CH340
    'USB\\VID_1A86&PID_7523'
];

/**
 * Configuration of serialport
 * @readonly
 */
const SERIAL_CONFIG = {
    baudRate: 57600,
    dataBits: 8,
    stopBits: 1
};

/**
 * Configuration for arduino-cli.
 * @readonly
 */
const DEVICE_OPT = {
    type: 'arduino',
    fqbn: 'arduino:avr:uno',
    firmware: 'arduinoUno.hex'
};

const Pins = {
    D0: '0',
    D1: '1',
    D2: '2',
    D3: '3',
    D4: '4',
    D5: '5',
    D6: '6',
    D7: '7',
    D8: '8',
    D9: '9',
    D10: '10',
    D11: '11',
    D12: '12',
    D13: '13',
    A0: 'A0',
    A1: 'A1',
    A2: 'A2',
    A3: 'A3',
    A4: 'A4',
    A5: 'A5'
};

const Level = {
    High: 'HIGH',
    Low: 'LOW'
};

const Buadrate = {
    B4800: '4800',
    B9600: '9600',
    B19200: '19200',
    B38400: '38400',
    B57600: '57600',
    B76800: '76800',
    B115200: '115200'
};

const Eol = {
    Warp: 'warp',
    NoWarp: 'noWarp'
};

const Mode = {
    Input: 'INPUT',
    Output: 'OUTPUT',
    InputPullup: 'INPUT_PULLUP'
};

const Direction = {
    Forward: 'FORWARD',
    Backward: 'BACKWARD',
    TurnLeft: 'TURN_LEFT',
    TurnRight: 'TURN_RIGHT'
};

const PinsMap = {
    // RoboPro
    LeftMotorReverse: Pins.D4,
    LeftMotorPwm: Pins.D5,
    RightMotorPwm: Pins.D6,
    RightMotorReverse: Pins.D7,
    // Keyestudio
    /*
    LeftMotorReverse: Pins.D12,
    LeftMotorPwm: Pins.D3,
    RightMotorPwm: Pins.D11,
    RightMotorReverse: Pins.D13,
     */
    // Common
    A0: Pins.A0,
    A1: Pins.A1,
    A2: Pins.A2,
    A3: Pins.A3,
    A4: Pins.A4,
    A5: Pins.A5
};

const MonitoringPins = ['A0', 'A1', 'A2', 'A3', 'A4', 'A5'];

const MIN_MOTOR_POWER = 0;
const MAX_MOTOR_POWER = 255;
const DEGREE_RATIO = 120;
const IN_SENSOR_MIN = 0;
const IN_SENSOR_MAX = 1023;
const OUT_SENSOR_MIN = 0;
const OUT_SENSOR_MAX = 100;

/**
 * Manage communication with an Arduino Nano peripheral over a OpenBlock Link client socket.
 */
class RoboProBot extends ArduinoPeripheral {
    /**
     * Construct a Arduino communication object.
     * @param {Runtime} runtime - the OpenBlock runtime
     * @param {string} deviceId - the id of the extension
     * @param {string} originalDeviceId - the original id of the peripheral, like xxx_arduinoUno
     */
    constructor (runtime, deviceId, originalDeviceId) {
        super(runtime, deviceId, originalDeviceId, PNPID_LIST, SERIAL_CONFIG, DEVICE_OPT, Pins, MonitoringPins);
    }

    /**
     * Re-maps sensor value from the 0...1023 range to the 0...100 range.
     * @param {Pins} pin - sensor pin
     * @param {number} value - value from the sensor.
     * @return {number} re-mapped value
     * @private
     */
    mapPinValue (pin, value) {
        switch (pin) {
        case PinsMap.A3:
            value = IN_SENSOR_MAX - value;
            break;
        }

        switch (pin) {
        case Pins.A0:
        case Pins.A1:
        case Pins.A2:
        case Pins.A3:
        case Pins.A4:
        case Pins.A5:
            value = ((value - IN_SENSOR_MIN) * (OUT_SENSOR_MAX - OUT_SENSOR_MIN) / (IN_SENSOR_MAX - IN_SENSOR_MIN)) +
                OUT_SENSOR_MIN;
            return Math.round(value);
        }
        return value;
    }
}

/**
 * OpenBlock blocks to interact with a Arduino Nano Ultra peripheral.
 */
class OpenBlockRoboProBotDevice extends OpenBlockArduinoUnoDevice {

    /**
     * @return {string} - the ID of this extension.
     */
    get DEVICE_ID () {
        return 'roboProBot';
    }

    get DIRECTIONS_MENU () {
        return [
            {
                text: formatMessage({
                    id: 'roboPro.directionsMenu.forward',
                    default: 'forward',
                    description: 'label for forward direction'
                }),
                value: Direction.Forward
            },
            {
                text: formatMessage({
                    id: 'roboPro.directionsMenu.backward',
                    default: 'backward',
                    description: 'label for backward direction'
                }),
                value: Direction.Backward
            },
            {
                text: formatMessage({
                    id: 'roboPro.directionsMenu.turnLeft',
                    default: 'turn left',
                    description: 'label for turn left direction'
                }),
                value: Direction.TurnLeft
            },
            {
                text: formatMessage({
                    id: 'roboPro.directionsMenu.turnRight',
                    default: 'turn right',
                    description: 'label for turn right direction'
                }),
                value: Direction.TurnRight
            }
        ];
    }

    get SENSORS_MENU () {
        return [
            {
                text: formatMessage({
                    id: 'roboPro.sensorsMenu.sensorA0',
                    default: 'A0',
                    description: 'label for A0 sensor'
                }),
                value: PinsMap.A0
            },
            {
                text: formatMessage({
                    id: 'roboPro.sensorsMenu.sensorA1',
                    default: 'A1',
                    description: 'label for A1 sensor'
                }),
                value: PinsMap.A1
            },
            {
                text: formatMessage({
                    id: 'roboPro.sensorsMenu.sensorA2',
                    default: 'A2',
                    description: 'label for A2 sensor'
                }),
                value: PinsMap.A2
            },
            {
                text: formatMessage({
                    id: 'roboPro.sensorsMenu.sensorA3',
                    default: 'A3',
                    description: 'label for A3 sensor'
                }),
                value: PinsMap.A3
            },
            {
                text: formatMessage({
                    id: 'roboPro.sensorsMenu.sensorA4',
                    default: 'A4',
                    description: 'label for A4 sensor'
                }),
                value: PinsMap.A4
            },
            {
                text: formatMessage({
                    id: 'roboPro.sensorsMenu.sensorA5',
                    default: 'A5',
                    description: 'label for A5 sensor'
                }),
                value: PinsMap.A5
            }
        ];
    }

    /**
     * Construct a set of Arduino blocks.
     * @param {Runtime} runtime - the OpenBlock runtime.
     * @param {string} originalDeviceId - the original id of the peripheral, like xxx_arduinoUno
     */
    constructor (runtime, originalDeviceId) {
        super(runtime, originalDeviceId);
        this._init = this._init.bind(this);

        // Create a new Arduino Nano peripheral instance
        this._peripheral = new RoboProBot(this.runtime, this.DEVICE_ID, originalDeviceId);

        this._directionRight = Direction.Forward;
        this._directionLeft = Direction.Forward;
        this._powerRight = MAX_MOTOR_POWER;
        this._powerLeft = MAX_MOTOR_POWER;
        this._motorsOnForSecondsTimeout = null;
        this._peripheral.on('connected', this._init);
    }

    _init () {
        this._peripheral.setPinMode(PinsMap.LeftMotorReverse, Mode.Output);
        this._peripheral.setPinMode(PinsMap.LeftMotorPwm, Mode.Output);
        this._peripheral.setPinMode(PinsMap.RightMotorReverse, Mode.Output);
        this._peripheral.setPinMode(PinsMap.RightMotorPwm, Mode.Output);
    }

    /**
     * @returns {Array.<object>} metadata for this extension and its blocks.
     */
    getInfo () {
        return [
            {
                id: 'roboProBot',
                name: formatMessage({
                    id: 'roboPro.category.roboProBot',
                    default: 'RoboPro Bot',
                    description: 'The name of the arduino uno device pin category'
                }),
                blockIconURI: blockIconURI,
                menuIconURI: menuIconURI,
                color1: '#00AF41',
                color2: '#AAAAAA',
                color3: '#00AF41',

                blocks: [
                    {
                        opcode: 'motorsOnForSeconds',
                        text: formatMessage({
                            id: 'roboPro.bot.motorsOnForSeconds',
                            default: 'motors on for [SECONDS] seconds',
                            description: 'roboProBot turn on motors'
                        }),
                        blockType: BlockType.COMMAND,
                        arguments: {
                            SECONDS: {
                                type: ArgumentType.NUMBER,
                                defaultValue: '1'
                            }
                        }
                    },
                    {
                        opcode: 'motorsOn',
                        text: formatMessage({
                            id: 'roboPro.bot.motorsOn',
                            default: 'motors on',
                            description: 'Turn on motors'
                        }),
                        blockType: BlockType.COMMAND
                    },
                    {
                        opcode: 'motorsOff',
                        text: formatMessage({
                            id: 'roboPro.bot.motorsOff',
                            default: 'motors off',
                            description: 'Turn off motors'
                        }),
                        blockType: BlockType.COMMAND
                    },
                    {
                        opcode: 'setDirectionTo',
                        text: formatMessage({
                            id: 'roboPro.bot.setDirectionTo',
                            default: 'set robot direction to [DIRECTION]',
                            description: 'Set robot direction'
                        }),
                        blockType: BlockType.COMMAND,
                        arguments: {
                            DIRECTION: {
                                type: ArgumentType.STRING,
                                menu: 'directions',
                                defaultValue: Direction.Forward
                            }
                        }
                    },
                    {
                        opcode: 'turnRight',
                        text: formatMessage({
                            id: 'roboPro.bot.turnRight',
                            default: 'turn right for [DEGREES] degrees',
                            description: 'Turn robot right'
                        }),
                        blockType: BlockType.COMMAND,
                        arguments: {
                            DEGREES: {
                                type: ArgumentType.ANGLE,
                                defaultValue: 15
                            }
                        }
                    },
                    {
                        opcode: 'turnLeft',
                        text: formatMessage({
                            id: 'roboPro.bot.turnLeft',
                            default: 'turn left for [DEGREES] degrees',
                            description: 'Turn robot left'
                        }),
                        blockType: BlockType.COMMAND,
                        arguments: {
                            DEGREES: {
                                type: ArgumentType.ANGLE,
                                defaultValue: 15
                            }
                        }
                    },
                    {
                        opcode: 'setMotorsPower',
                        text: formatMessage({
                            id: 'roboPro.bot.setMotorsPower',
                            default: 'set motors power [POWER] %',
                            description: 'Set motors power'
                        }),
                        blockType: BlockType.COMMAND,
                        arguments: {
                            POWER: {
                                type: ArgumentType.NUMBER,
                                defaultValue: 30
                            }
                        }
                    },
                    {
                        opcode: 'setMotorsPowerLR',
                        text: formatMessage({
                            id: 'roboPro.bot.setMotorsPowerLR',
                            default: 'set motors power L [POWER_LEFT] R [POWER_RIGHT] %',
                            description: 'Set motors power separately'
                        }),
                        blockType: BlockType.COMMAND,
                        arguments: {
                            POWER_LEFT: {
                                type: ArgumentType.NUMBER,
                                defaultValue: 30
                            },
                            POWER_RIGHT: {
                                type: ArgumentType.NUMBER,
                                defaultValue: 30
                            }
                        }
                    },
                    {
                        opcode: 'setPowerAndDirection',
                        text: formatMessage({
                            id: 'roboPro.bot.setPowerAndDirection',
                            default: 'L [DIRECTION_LEFT] R [DIRECTION_RIGHT] set power ' +
                                'L [POWER_LEFT] R [POWER_RIGHT] %',
                            description: 'Set robot power and direction'
                        }),
                        blockType: BlockType.COMMAND,
                        arguments: {
                            DIRECTION_LEFT: {
                                type: ArgumentType.STRING,
                                menu: 'directions',
                                defaultValue: Direction.Forward
                            },
                            DIRECTION_RIGHT: {
                                type: ArgumentType.STRING,
                                menu: 'directions',
                                defaultValue: Direction.Forward
                            },
                            POWER_LEFT: {
                                type: ArgumentType.NUMBER,
                                defaultValue: 30
                            },
                            POWER_RIGHT: {
                                type: ArgumentType.NUMBER,
                                defaultValue: 30
                            }
                        }
                    },
                    {
                        opcode: 'readSensor',
                        text: formatMessage({
                            id: 'roboPro.bot.readSensor',
                            default: 'read sensor [PIN]',
                            description: 'Read sensor value'
                        }),
                        blockType: BlockType.REPORTER,
                        arguments: {
                            PIN: {
                                type: ArgumentType.STRING,
                                menu: 'sensors',
                                defaultValue: PinsMap.A0
                            }
                        }
                    },
                    {
                        opcode: 'serialBegin',
                        text: formatMessage({
                            id: 'arduinoUno.serial.serialBegin',
                            default: 'serial begin baudrate [VALUE]',
                            description: 'arduinoUno serial begin'
                        }),
                        blockType: BlockType.COMMAND,
                        arguments: {
                            VALUE: {
                                type: ArgumentType.STRING,
                                menu: 'baudrate',
                                defaultValue: Buadrate.B9600
                            }
                        },
                        programMode: [ProgramModeType.UPLOAD]
                    },
                    {
                        opcode: 'serialPrint',
                        text: formatMessage({
                            id: 'arduinoUno.serial.serialPrint',
                            default: 'serial print [VALUE] [EOL]',
                            description: 'arduinoUno serial print'
                        }),
                        blockType: BlockType.COMMAND,
                        arguments: {
                            VALUE: {
                                type: ArgumentType.STRING,
                                defaultValue: 'Hello OpenBlock'
                            },
                            EOL: {
                                type: ArgumentType.STRING,
                                menu: 'eol',
                                defaultValue: Eol.Warp
                            }
                        },
                        programMode: [ProgramModeType.UPLOAD]
                    }
                ],
                menus: {
                    directions: {
                        items: this.DIRECTIONS_MENU
                    },
                    sensors: {
                        items: this.SENSORS_MENU
                    }
                }
            }
        ];
    }

    /**
     * Turn on motors for seconds.
     * @param {object} args - the block's arguments.
     * @param {BlockUtility} util - utility object provided by the runtime.
     * @return {Promise} - a Promise that resolves on motors switched on and off.
     */
    motorsOnForSeconds (args, util) {
        return this._motorsOnForSeconds(args.SECONDS, util);
    }

    /**
     * Turn on motors.
     * @param {object} args - the block's arguments.
     * @param {BlockUtility} util - utility object provided by the runtime.
     * @return {Promise} - a Promise that resolves on motors switched on.
     */
    motorsOn (args, util) {
        return this._motorsOn(util);
    }

    /**
     * Turn off motors.
     * @param {object} args - the block's arguments.
     * @param {BlockUtility} util - utility object provided by the runtime.
     * @return {Promise} - a Promise that resolves on motors switched off.
     */
    motorsOff (args, util) {
        return this._motorsOff(util);
    }

    /**
     * Set robot direction.
     * @param {object} args - the block's arguments.
     * @param {BlockUtility} util - utility object provided by the runtime.
     */
    setDirectionTo (args) {
        this._setDirection(args.DIRECTION);
    }

    /**
     * Turn robot right.
     * @param {object} args - the block's arguments.
     * @param {object} util - utility object provided by the runtime.
     * @return {Promise} - a Promise that resolves on the bot turned.
     */
    turnRight (args, util) {
        this._setDirection(Direction.TurnRight);
        return this._motorsOnForSeconds(args.DEGREES / DEGREE_RATIO, util);
    }

    /**
     * Turn robot left.
     * @param {object} args - the block's arguments.
     * @param {object} util - utility object provided by the runtime.
     * @return {Promise} - a Promise that resolves on the bot turned.
     **/
    turnLeft (args, util) {
        this._setDirection(Direction.TurnLeft);
        return this._motorsOnForSeconds(args.DEGREES / DEGREE_RATIO, util);
    }

    /**
     * Set motors power.
     * @param {object} args - the block's arguments.
     **/
    setMotorsPower (args) {
        this._powerLeft = this._convertPercentPower(args.POWER);
        this._powerRight = this._convertPercentPower(args.POWER);
    }

    /**
     * Set motors power separately.
     * @param {object} args - the block's arguments.
     **/
    setMotorsPowerLR (args) {
        this._powerLeft = this._convertPercentPower(args.POWER_LEFT);
        this._powerRight = this._convertPercentPower(args.POWER_RIGHT);
    }

    /**
     * Set left and right motors power and direction.
     * @param {object} args - the block's arguments.
     */
    setPowerAndDirection (args) {
        this._directionLeft = args.DIRECTION_LEFT;
        this._directionRight = args.DIRECTION_RIGHT;
        this._powerLeft = this._convertPercentPower(args.POWER_LEFT);
        this._powerRight = this._convertPercentPower(args.POWER_RIGHT);
    }

    /**
     * Read sensor.
     * @param {object} args - the block's arguments.
     * @return {Promise} - a Promise that resolves when read from peripheral.
     */
    readSensor (args) {
        const promise = this._peripheral.readAnalogPin(args.PIN);
        return promise.then(value => this._peripheral.mapPinValue(args.PIN, value));
    }

    /**
     * Set direction
     * @param {Direction} direction - direction
     */
    _setDirection (direction) {
        switch (direction) {
        case Direction.Forward:
        case Direction.Backward:
            this._directionLeft = direction;
            this._directionRight = direction;
            break;
        case Direction.TurnRight:
            this._directionLeft = Direction.Forward;
            this._directionRight = Direction.Backward;
            break;
        case Direction.TurnLeft:
            this._directionLeft = Direction.Backward;
            this._directionRight = Direction.Forward;
            break;
        }
    }

    _motorsOnForSeconds (durationSec, util) {
        if (this._stackTimerNeedsInit(util)) {
            const duration = Math.max(0, Cast.toNumber(durationSec));
            clearTimeout(this._motorsOnForSecondsTimeout);
            this._motorsOnForSecondsTimeout = setTimeout(() => {
                this._motorsOff().then();
            }, duration * 1000);
            this._startStackTimer(util, duration);
            return this._motorsOn(util);
        }
        this._checkStackTimer(util);
    }

    _motorsOn () {
        return Promise.all([
            this._peripheral.setDigitalOutput(PinsMap.LeftMotorReverse,
                this._directionLeft === Direction.Backward ? Level.High : Level.Low),
            this._peripheral.setPwmOutput(PinsMap.LeftMotorPwm, this._powerLeft),
            this._peripheral.setDigitalOutput(PinsMap.RightMotorReverse,
                this._directionRight === Direction.Backward ? Level.High : Level.Low),
            this._peripheral.setPwmOutput(PinsMap.RightMotorPwm, this._powerRight)
        ]);
    }

    _motorsOff () {
        return Promise.all([
            this._peripheral.setPwmOutput(PinsMap.LeftMotorPwm, MIN_MOTOR_POWER),
            this._peripheral.setPwmOutput(PinsMap.RightMotorPwm, MIN_MOTOR_POWER)
        ]);
    }

    _convertPercentPower (percentPower) {
        if (percentPower < 0) {
            percentPower = 0;
        } else if (percentPower > 100) {
            percentPower = 100;
        }
        return ((percentPower * (MAX_MOTOR_POWER - MIN_MOTOR_POWER)) / 100) + MIN_MOTOR_POWER;
    }

    /**
     * Check if the stack timer needs initialization.
     * @param {object} util - utility object provided by the runtime.
     * @return {boolean} - true if the stack timer needs to be initialized.
     * @private
     */
    _stackTimerNeedsInit (util) {
        return !util.stackFrame.timer;
    }

    /**
     * Start the stack timer and the yield the thread if necessary.
     * @param {object} util - utility object provided by the runtime.
     * @param {number} duration - a duration in seconds to set the timer for.
     * @private
     */
    _startStackTimer (util, duration) {
        util.stackFrame.timer = new Timer();
        util.stackFrame.timer.start();
        util.stackFrame.duration = duration;
        util.yield();
    }

    /**
     * Check the stack timer, and if its time is not up yet, yield the thread.
     * @param {object} util - utility object provided by the runtime.
     * @private
     */
    _checkStackTimer (util) {
        const timeElapsed = util.stackFrame.timer.timeElapsed();
        if (timeElapsed < util.stackFrame.duration * 1000) {
            util.yield();
        }
    }
}

module.exports = OpenBlockRoboProBotDevice;
